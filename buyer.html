<!DOCTYPE html>
<html>
<head>

<meta charset="UTF-8">

<meta name="viewport"
content="width=device-width,
initial-scale=1,
maximum-scale=1,
viewport-fit=cover">

<title>PetalRush Buyer</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>

/* ---------- RESET ---------- */

*{
box-sizing:border-box;
margin:0;
padding:0;
}

html,body{
height:100%;
width:100%;
font-family:system-ui,-apple-system,Segoe UI,Roboto;
background:#f4f6f8;
overflow-x:hidden;
}


/* ---------- CONTAINER ---------- */

.container{

width:100%;
max-width:500px;
min-height:100vh;

margin:auto;

background:#f4f6f8;

display:flex;
flex-direction:column;

position:relative;

}


/* DESKTOP CENTER MODE */

@media(min-width:700px){

.container{

margin-top:20px;
margin-bottom:20px;

border-radius:14px;

box-shadow:0 0 30px rgba(0,0,0,0.12);

min-height:90vh;

}

}


/* ---------- HEADER ---------- */

.header{

background:white;

padding:14px clamp(12px,4vw,18px);

box-shadow:0 2px 12px rgba(0,0,0,0.08);

position:sticky;
top:0;
z-index:100;

}

.location{

font-size:clamp(16px,4vw,20px);
font-weight:600;

}

.search{

margin-top:8px;

}

.search input{

width:100%;

padding:clamp(10px,3vw,14px);

font-size:clamp(14px,3.5vw,16px);

border-radius:10px;

border:1px solid #ddd;

}


/* ---------- PRODUCTS ---------- */

.products{

display:grid;

grid-template-columns:repeat(auto-fit,minmax(140px,1fr));

gap:clamp(10px,3vw,16px);

padding:clamp(12px,3vw,16px);

padding-bottom:90px;

}

.card{

background:white;

border-radius:12px;

padding:10px;

box-shadow:0 3px 12px rgba(0,0,0,0.08);

}

.card img{

width:100%;
aspect-ratio:1/1;
object-fit:cover;
border-radius:10px;

}

.card h3{

font-size:clamp(14px,3.5vw,17px);
margin-top:6px;

}

.price{

color:#ff4081;
font-weight:bold;

}

.btn{

width:100%;
padding:12px;
background:#ff4081;
color:white;
border:none;
border-radius:10px;
font-size:15px;
margin-top:6px;

}


/* ---------- PROFILE ---------- */

.profile{

display:none;
padding:14px;
padding-bottom:90px;

}

.profile-card{

background:white;
padding:18px;
border-radius:12px;
text-align:center;

}

.avatar{

width:90px;
height:90px;
border-radius:50%;
object-fit:cover;

}

.input{

width:100%;
padding:12px;
border-radius:10px;
border:1px solid #ddd;
margin-top:8px;

}

.menu{

margin-top:12px;
background:white;
border-radius:12px;

}

.menu-item{

padding:16px;
border-bottom:1px solid #eee;

}


/* ---------- ADDRESS ---------- */

.address{

display:none;
padding:14px;

}


/* ---------- HELP ---------- */

.help{

display:none;
padding:14px;

}

.help-card{

background:white;
padding:18px;
border-radius:12px;

}


/* ---------- CART ---------- */

.cart{

display:none;
padding:14px;

}


/* ---------- BOTTOM NAV ---------- */

.bottom{

position:fixed;

bottom:0;

width:100%;
max-width:500px;

background:white;

display:flex;
justify-content:space-around;

padding:12px;

box-shadow:0 -3px 15px rgba(0,0,0,0.08);

}

.nav{

font-size:15px;
cursor:pointer;

}

</style>

</head>

<body>


<div class="container">


<!-- HEADER -->

<div class="header">

<div class="location">
Mumbai
</div>

<div class="search">
<input placeholder="Search flowers">
</div>

</div>



<!-- PRODUCTS -->

<div id="home" class="products"></div>



<!-- PROFILE -->

<div id="profile" class="profile">

<div class="profile-card">

<img id="avatar" class="avatar"
src="https://via.placeholder.com/90">

<br><br>

<input type="file" onchange="uploadAvatar(event)">

<h3 id="username"></h3>

<input id="nameInput"
class="input"
placeholder="Edit name">

<button class="btn"
onclick="saveProfile()">
Save Profile
</button>

</div>


<div class="menu">

<div class="menu-item"
onclick="openAddress()">
My Address
</div>

<div class="menu-item"
onclick="openHelp()">
Help & Support
</div>

<div class="menu-item"
onclick="logout()">
Logout
</div>

</div>

</div>



<!-- ADDRESS -->

<div id="address" class="address">

<h3>Save Address</h3>

<input id="addressInput"
class="input"
placeholder="Enter address">

<button class="btn"
onclick="getGPS()">
Use GPS
</button>

<button class="btn"
onclick="saveAddress()">
Save Address
</button>

</div>



<!-- HELP -->

<div id="help" class="help">

<div class="help-card">

<h3>Support</h3>

<p id="supportEmail"></p>

<p id="supportPhone"></p>

</div>

</div>



<!-- CART -->

<div id="cart" class="cart">

<h3>Cart coming soon</h3>

</div>



<!-- NAV -->

<div class="bottom">

<div class="nav"
onclick="showHome()">
Home
</div>

<div class="nav"
onclick="showProfile()">
Profile
</div>

<div class="nav"
onclick="showCart()">
Cart
</div>

</div>


</div>



<script>


const SUPABASE_URL="https://lssjsgfppehhclxqulso.supabase.co";

const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxzc2pzZ2ZwcGVoaGNseHF1bHNvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExOTAwNzksImV4cCI6MjA4Njc2NjA3OX0.nRq1iFBiOEyty0ALRmS45ARoso7BsB0ENOvttu7nvX0";

const client=supabase.createClient(
SUPABASE_URL,
SUPABASE_KEY
);


const user=
JSON.parse(localStorage.getItem("user"));

if(!user){

location="index.html";

}

username.innerText=user.email;



async function loadProducts(){

const {data}=await client
.from("products")
.select("*");

home.innerHTML="";

data.forEach(p=>{

home.innerHTML+=`

<div class="card">

<img src="${p.image_url}">

<h3>${p.name}</h3>

<div class="price">â‚¹${p.price}</div>

<button class="btn">Add</button>

</div>

`;

});

}

loadProducts();



async function saveProfile(){

const name=nameInput.value;

await client
.from("users")
.update({name})
.eq("email",user.email);

alert("Saved");

}



async function uploadAvatar(e){

const file=e.target.files[0];

await client.storage
.from("avatars")
.upload(user.email,file,{upsert:true});

avatar.src=
SUPABASE_URL+
"/storage/v1/object/public/avatars/"+user.email;

}



async function saveAddress(){

const address=
addressInput.value;

await client
.from("users")
.update({address})
.eq("email",user.email);

alert("Address Saved");

}



function getGPS(){

navigator.geolocation.getCurrentPosition(pos=>{

addressInput.value=
"https://maps.google.com/?q="+
pos.coords.latitude+
","+
pos.coords.longitude;

});

}



async function openHelp(){

hideAll();

help.style.display="block";

const {data}=await client
.from("admin")
.select("*")
.single();

supportEmail.innerText=data.email;

supportPhone.innerText=data.phone;

}



function hideAll(){

home.style.display="none";
profile.style.display="none";
cart.style.display="none";
address.style.display="none";
help.style.display="none";

}



function showHome(){

hideAll();

home.style.display="grid";

}



function showProfile(){

hideAll();

profile.style.display="block";

}



function showCart(){

hideAll();

cart.style.display="block";

}



function openAddress(){

hideAll();

address.style.display="block";

}



function logout(){

localStorage.removeItem("user");

location="index.html";

}


</script>


</body>
</html>
