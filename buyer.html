<!DOCTYPE html>
<html>
<head>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>PetalRush Buyer</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>

/* ---------- GLOBAL ---------- */

:root{

--primary:#ff4081;
--bg:#f4f6f8;
--card:#ffffff;
--text:#222;
--muted:#777;

}

body{

margin:0;
font-family:system-ui,-apple-system,Segoe UI,Roboto;
background:var(--bg);

}


/* DESKTOP CENTER LAYOUT */

.container{

max-width:500px;
margin:auto;
background:var(--bg);
min-height:100vh;
position:relative;

}


/* HEADER */

.header{

background:white;
padding:16px;
box-shadow:0 2px 10px rgba(0,0,0,0.1);

}

.location{

font-size:18px;
font-weight:600;

}

.search{

margin-top:10px;

}

.search input{

width:100%;
padding:12px;
border-radius:10px;
border:1px solid #ddd;
font-size:15px;

}


/* PRODUCTS */

.products{

display:grid;
grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
gap:12px;
padding:12px;

}

.card{

background:white;
border-radius:12px;
padding:10px;
box-shadow:0 2px 10px rgba(0,0,0,0.08);

}

.card img{

width:100%;
height:140px;
object-fit:cover;
border-radius:10px;

}

.card h3{

font-size:16px;
margin:6px 0;

}

.price{

color:var(--primary);
font-weight:bold;

}

.btn{

background:var(--primary);
color:white;
border:none;
padding:10px;
width:100%;
border-radius:8px;
margin-top:6px;
cursor:pointer;

}


/* PROFILE */

.profile{

display:none;
padding:12px;

}

.profile-card{

background:white;
padding:15px;
border-radius:12px;
text-align:center;

}

.avatar{

width:80px;
height:80px;
border-radius:50%;
object-fit:cover;

}

.edit{

font-size:14px;
color:var(--primary);
cursor:pointer;

}

.menu{

background:white;
margin-top:10px;
border-radius:12px;

}

.menu-item{

padding:14px;
border-bottom:1px solid #eee;
cursor:pointer;

}


/* ADDRESS */

.address{

display:none;
padding:12px;

}

.input{

width:100%;
padding:12px;
margin-bottom:10px;
border-radius:8px;
border:1px solid #ddd;

}


/* HELP */

.help{

display:none;
padding:12px;

}

.help-card{

background:white;
padding:15px;
border-radius:12px;

}


/* CART */

.cart{

display:none;
padding:12px;

}


/* BOTTOM NAV */

.bottom{

position:fixed;
bottom:0;
width:100%;
max-width:500px;
background:white;
display:flex;
justify-content:space-around;
padding:10px;
box-shadow:0 -2px 10px rgba(0,0,0,0.1);

}

.nav{

cursor:pointer;
font-size:14px;

}


/* DESKTOP MODE */

@media(min-width:700px){

.container{

margin-top:20px;
border-radius:12px;
box-shadow:0 0 20px rgba(0,0,0,0.1);

}

}

</style>

</head>

<body>

<div class="container">


<!-- HEADER -->

<div class="header">

<div class="location" id="locationText">
Mumbai
</div>

<div class="search">
<input placeholder="Search flowers">
</div>

</div>



<!-- PRODUCTS -->

<div id="home" class="products"></div>



<!-- PROFILE -->

<div id="profile" class="profile">

<div class="profile-card">

<img id="avatar" class="avatar"
src="https://via.placeholder.com/80">

<br><br>

<input type="file" onchange="uploadAvatar(event)">

<h3 id="username">User</h3>

<input id="nameInput"
class="input"
placeholder="Edit name">

<button class="btn" onclick="saveProfile()">
Save Profile
</button>

</div>


<div class="menu">

<div class="menu-item" onclick="openAddress()">
My Address
</div>

<div class="menu-item" onclick="openHelp()">
Help & Support
</div>

<div class="menu-item" onclick="logout()">
Logout
</div>

</div>

</div>



<!-- ADDRESS -->

<div id="address" class="address">

<h3>Save Address</h3>

<input id="addressInput"
class="input"
placeholder="Enter address">

<button class="btn" onclick="getGPS()">
Use GPS Location
</button>

<button class="btn" onclick="saveAddress()">
Save Address
</button>

</div>



<!-- HELP -->

<div id="help" class="help">

<div class="help-card">

<h3>Support</h3>

<p id="supportEmail">
Loading...
</p>

<p id="supportPhone">
Loading...
</p>

</div>

</div>



<!-- CART -->

<div id="cart" class="cart">

<h3>Cart coming soon</h3>

</div>



<!-- NAV -->

<div class="bottom">

<div class="nav" onclick="showHome()">
Home
</div>

<div class="nav" onclick="showProfile()">
Profile
</div>

<div class="nav" onclick="showCart()">
Cart
</div>

</div>


</div>



<script>


// SUPABASE CONFIG

const SUPABASE_URL="https://lssjsgfppehhclxqulso.supabase.co";

const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxzc2pzZ2ZwcGVoaGNseHF1bHNvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExOTAwNzksImV4cCI6MjA4Njc2NjA3OX0.nRq1iFBiOEyty0ALRmS45ARoso7BsB0ENOvttu7nvX0";

const client=supabase.createClient(
SUPABASE_URL,
SUPABASE_KEY
);


// USER

const user=JSON.parse(localStorage.getItem("user"));

if(!user){

location="index.html";

}

document.getElementById("username").innerText=user.email;



// LOAD PRODUCTS

async function loadProducts(){

const {data}=await client
.from("products")
.select("*");

const div=document.getElementById("home");

data.forEach(p=>{

div.innerHTML+=`

<div class="card">

<img src="${p.image_url}">

<h3>${p.name}</h3>

<div class="price">â‚¹${p.price}</div>

<button class="btn">
Add
</button>

</div>

`;

});

}

loadProducts();



// PROFILE SAVE

async function saveProfile(){

const name=document.getElementById("nameInput").value;

await client.from("users")
.update({name})
.eq("email",user.email);

alert("Profile saved");

}



// AVATAR

async function uploadAvatar(e){

const file=e.target.files[0];

await client.storage
.from("avatars")
.upload(user.email,file,{upsert:true});

const url=
SUPABASE_URL+
"/storage/v1/object/public/avatars/"+user.email;

document.getElementById("avatar").src=url;

}



// ADDRESS SAVE

async function saveAddress(){

const address=
document.getElementById("addressInput").value;

await client.from("users")
.update({address})
.eq("email",user.email);

alert("Address saved");

}



// GPS

function getGPS(){

navigator.geolocation.getCurrentPosition(pos=>{

const lat=pos.coords.latitude;

const lon=pos.coords.longitude;

document.getElementById("addressInput").value=
`https://maps.google.com/?q=${lat},${lon}`;

});

}



// HELP LOAD

async function openHelp(){

hideAll();

document.getElementById("help").style.display="block";

const {data}=await client
.from("admin")
.select("*")
.single();

document.getElementById("supportEmail").innerText=data.email;

document.getElementById("supportPhone").innerText=data.phone;

}



// NAVIGATION

function hideAll(){

home.style.display="none";
profile.style.display="none";
cart.style.display="none";
address.style.display="none";
help.style.display="none";

}

function showHome(){

hideAll();
home.style.display="grid";

}

function showProfile(){

hideAll();
profile.style.display="block";

}

function showCart(){

hideAll();
cart.style.display="block";

}

function openAddress(){

hideAll();
address.style.display="block";

}



// LOGOUT

function logout(){

localStorage.removeItem("user");

location="index.html";

}


</script>

</body>
</html>
