<!DOCTYPE html>
<html>
<head>

<meta name="viewport" content="width=device-width, initial-scale=1">

<title>PetalRush</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>

body{
margin:0;
background:#0f1115;
color:white;
font-family:system-ui;
}

.container{
max-width:500px;
margin:auto;
min-height:100vh;
}

.header{
display:flex;
gap:10px;
padding:12px;
background:#111;
}

.logo{
height:40px;
}

.search{
flex:1;
padding:10px;
border-radius:8px;
border:none;
background:#222;
color:white;
}

.products{
display:grid;
grid-template-columns:repeat(2,1fr);
gap:12px;
padding:12px;
padding-bottom:80px;
}

.card{
background:#171a21;
padding:10px;
border-radius:10px;
cursor:pointer;
}

.card img{
width:100%;
height:120px;
object-fit:cover;
border-radius:8px;
}

.price{
color:#ff4081;
}

.section{
display:none;
padding:12px;
padding-bottom:80px;
}

.btn{
background:#ff4081;
border:none;
padding:12px;
width:100%;
border-radius:8px;
color:white;
margin-top:10px;
}

.input{
width:100%;
padding:10px;
margin-top:10px;
background:#222;
border:none;
color:white;
border-radius:8px;
}

.bottom{
position:fixed;
bottom:0;
width:100%;
max-width:500px;
display:flex;
justify-content:space-around;
background:#111;
padding:12px;
}

.menu{
margin-top:20px;
}

.menu div{
padding:12px;
border-bottom:1px solid #333;
cursor:pointer;
}

.avatar{
width:100px;
height:100px;
border-radius:50%;
object-fit:cover;
}

</style>

</head>

<body>

<div class="container">

<!-- HEADER -->

<div class="header">
<img src="logoHeader.png" class="logo">
<input id="search" class="search" placeholder="Search flowers">
</div>

<!-- HOME -->

<div id="home" class="products"></div>

<!-- DETAIL -->

<div id="detail" class="section"></div>

<!-- PROFILE -->

<div id="profile" class="section">

<img id="avatar" class="avatar" src="default-avatar.png">

<input type="file" onchange="uploadAvatar(event)">

<input id="name" class="input" placeholder="Name">

<input id="phone" class="input" placeholder="Phone">

<input id="address" class="input" placeholder="Address">

<button class="btn" onclick="getGPS()">Use GPS</button>

<button class="btn" onclick="saveProfile()">Save Profile</button>

<div class="menu">

<div onclick="showOrders()">My Orders</div>

<div onclick="openHelp()">Help & Support</div>

<div onclick="logout()">Logout</div>

</div>

</div>

<!-- CART -->

<div id="cart" class="section">

<h3>Cart</h3>

<div id="cartItems"></div>

<h3 id="total">Total ₹0</h3>

<button class="btn" onclick="placeOrder()">Place Order</button>

</div>

<!-- ORDERS -->

<div id="orders" class="section"></div>

<!-- BOTTOM -->

<div class="bottom">

<div onclick="showHome()">Home</div>

<div onclick="showProfile()">Profile</div>

<div onclick="showCart()">Cart</div>

</div>

</div>

<script>

const supabase = window.supabase.createClient(
"https://lssjsgfppehhclxqulso.supabase.co",
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxzc2pzZ2ZwcGVoaGNseHF1bHNvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExOTAwNzksImV4cCI6MjA4Njc2NjA3OX0.nRq1iFBiOEyty0ALRmS45ARoso7BsB0ENOvttu7nvX0"
);

const user = JSON.parse(localStorage.getItem("user"));

if(!user) location="index.html";

/* UTIL */

function hideAll(){

home.style.display="none";
detail.style.display="none";
profile.style.display="none";
cart.style.display="none";
orders.style.display="none";

}

/* HOME */

async function showHome(){

hideAll();

home.style.display="grid";

const {data}=await supabase.from("products").select("*");

home.innerHTML="";

data.forEach(p=>{

home.innerHTML+=`

<div class="card" onclick="showDetail('${p.id}')">

<img src="${p.images?.[0] || 'default-avatar.png'}">

${p.name}

<div class="price">₹${p.price}</div>

</div>

`;

});

}

/* DETAIL */

async function showDetail(id){

hideAll();

detail.style.display="block";

const {data}=await supabase.from("products").select("*").eq("id",id).single();

detail.innerHTML=`

<img src="${data.images?.[0]}" width="100%">

<h2>${data.name}</h2>

₹${data.price}

<p>${data.description}</p>

<button class="btn" onclick="addCart('${data.id}')">Add to cart</button>

`;

}

/* ADD CART */

async function addCart(id){

await supabase.from("cart").insert({
email:user.email,
product_id:id
});

alert("Added to cart");

}

/* CART */

async function showCart(){

hideAll();

cart.style.display="block";

const {data}=await supabase
.from("cart")
.select("*,products(*)")
.eq("email",user.email);

let total=0;

cartItems.innerHTML="";

data?.forEach(c=>{

total+=c.products.price;

cartItems.innerHTML+=`
<div>
${c.products.name} ₹${c.products.price}
</div>
`;

});

total.innerText="Total ₹"+total;

}

/* PROFILE */

function showProfile(){

hideAll();

profile.style.display="block";

}

/* SAVE PROFILE */

async function saveProfile(){

await supabase.from("users").upsert({
email:user.email,
name:name.value,
phone:phone.value,
address:address.value
});

alert("Saved");

}

/* GPS */

function getGPS(){

navigator.geolocation.getCurrentPosition(pos=>{

address.value=
`https://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}`;

});

}

/* AVATAR */

async function uploadAvatar(e){

const file=e.target.files[0];

await supabase.storage.from("avatars").upload(user.email,file,{upsert:true});

avatar.src=
"https://lssjsgfppehhclxqulso.supabase.co/storage/v1/object/public/avatars/"+user.email;

}

/* ORDERS */

async function showOrders(){

hideAll();

orders.style.display="block";

const {data}=await supabase.from("orders").select("*").eq("email",user.email);

orders.innerHTML="<h3>My Orders</h3>";

data?.forEach(o=>{

orders.innerHTML+=`
<div>
Order ₹${o.total}
</div>
`;

});

}

/* ORDER */

async function placeOrder(){

alert("Order placed");

}

/* HELP */

function openHelp(){

location="mailto:support@petalrush.com";

}

/* LOGOUT */

function logout(){

localStorage.removeItem("user");

location="index.html";

}

showHome();

</script>

</body>
</html>
