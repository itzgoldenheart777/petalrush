<!DOCTYPE html>
<html>
<head>

<meta name="viewport" content="width=device-width, initial-scale=1">

<title>PetalRush Buyer</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>

/* ================= GLOBAL ================= */

:root{
--primary:#ff4081;
--bg:#0f1115;
--card:#171a21;
--text:#ffffff;
--muted:#999;
}

*{
box-sizing:border-box;
margin:0;
padding:0;
}

body{
font-family:system-ui;
background:var(--bg);
color:var(--text);
}

/* ================= CONTAINER ================= */

.container{
max-width:500px;
margin:auto;
min-height:100vh;
background:var(--bg);
position:relative;
}

/* Desktop mode */

@media(min-width:700px){

.container{
margin-top:20px;
margin-bottom:20px;
border-radius:16px;
box-shadow:0 0 40px rgba(0,0,0,0.5);
}

}

/* ================= HEADER ================= */

.header{
display:flex;
align-items:center;
gap:10px;
padding:12px;
background:#111;
position:sticky;
top:0;
z-index:10;
}

.logo{
height:40px;
}

.search{
flex:1;
}

.search input{
width:100%;
padding:10px;
border-radius:10px;
border:none;
background:#222;
color:white;
}

/* ================= FILTER ================= */

.filter{
display:flex;
gap:8px;
padding:10px;
}

.filter select{
flex:1;
padding:8px;
border-radius:8px;
background:#222;
color:white;
border:none;
}

/* ================= PRODUCTS ================= */

.products{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
gap:12px;
padding:12px;
padding-bottom:90px;
}

.card{
background:var(--card);
border-radius:12px;
padding:10px;
cursor:pointer;
}

.card img{
width:100%;
height:130px;
object-fit:cover;
border-radius:10px;
}

.card h3{
font-size:15px;
margin-top:6px;
}

.price{
color:var(--primary);
font-weight:bold;
}

/* ================= PROFILE ================= */

.profile{
display:none;
padding:12px;
padding-bottom:90px;
}

.avatar{
width:100px;
height:100px;
border-radius:50%;
object-fit:cover;
margin:auto;
display:block;
}

.input{
width:100%;
padding:10px;
margin-top:8px;
border-radius:8px;
border:none;
background:#222;
color:white;
}

.btn{
width:100%;
padding:10px;
margin-top:10px;
border:none;
border-radius:8px;
background:var(--primary);
color:white;
cursor:pointer;
}

/* ================= ADDRESS ================= */

.address{
display:none;
padding:12px;
padding-bottom:90px;
}

.address-card{
background:var(--card);
padding:10px;
border-radius:10px;
margin-bottom:10px;
}

/* ================= CART ================= */

.cart{
display:none;
padding:12px;
padding-bottom:90px;
}

.cart-item{
display:flex;
gap:10px;
margin-bottom:10px;
background:var(--card);
padding:10px;
border-radius:10px;
}

/* ================= PRODUCT DETAIL ================= */

.detail{
display:none;
padding:12px;
padding-bottom:90px;
}

.detail img{
width:100%;
border-radius:12px;
}

.detail h2{
margin-top:10px;
}

.detail .price{
font-size:20px;
}

/* ================= BOTTOM NAV ================= */

.bottom{
position:fixed;
bottom:0;
width:100%;
max-width:500px;
background:#111;
display:flex;
justify-content:space-around;
padding:12px;
}

.nav{
cursor:pointer;
}

</style>

</head>

<body>

<div class="container">

<!-- HEADER -->

<div class="header">

<img src="logoHeader.png" class="logo">

<div class="search">
<input id="searchInput" placeholder="Search flowers">
</div>

</div>

<!-- FILTER -->

<div class="filter">

<select id="priceFilter">
<option value="">Sort Price</option>
<option value="low">Low to High</option>
<option value="high">High to Low</option>
</select>

</div>

<!-- HOME -->

<div id="home" class="products"></div>

<!-- PRODUCT DETAIL -->

<div id="detail" class="detail"></div>

<!-- PROFILE -->

<div id="profile" class="profile">

<img id="avatar" class="avatar"
src="https://via.placeholder.com/100">

<input type="file" onchange="uploadAvatar(event)">

<input id="nameInput" class="input" placeholder="Name">

<input id="phoneInput" class="input" placeholder="Phone">

<button class="btn" onclick="saveProfile()">
Save Profile
</button>

<br><br>

<div onclick="openAddress()">My Address</div>
<div onclick="openOrders()">My Orders</div>
<div onclick="openHelp()">Help & Support</div>
<div onclick="logout()">Logout</div>

</div>

<!-- ADDRESS -->

<div id="address" class="address">

<h3>My Address</h3>

<div id="addressList"></div>

<input id="addressInput" class="input"
placeholder="Enter address">

<button class="btn" onclick="saveAddress()">
Save Address
</button>

</div>

<!-- CART -->

<div id="cart" class="cart">

<h3>Cart</h3>

<div id="cartList"></div>

<button class="btn" onclick="placeOrder()">
Place Order
</button>

</div>

<!-- BOTTOM NAV -->

<div class="bottom">

<div class="nav" onclick="showHome()">Home</div>
<div class="nav" onclick="showProfile()">Profile</div>
<div class="nav" onclick="showCart()">Cart</div>

</div>

</div>

<script>

/* ================= SUPABASE ================= */

const supabase = window.supabase.createClient(
"https://lssjsgfppehhclxqulso.supabase.co",
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxzc2pzZ2ZwcGVoaGNseHF1bHNvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExOTAwNzksImV4cCI6MjA4Njc2NjA3OX0.nRq1iFBiOEyty0ALRmS45ARoso7BsB0ENOvttu7nvX0"
);

const user = JSON.parse(localStorage.getItem("user"));

if(!user) location="index.html";

/* ================= LOAD PRODUCTS ================= */

async function loadProducts(){

let query = supabase.from("products").select("*");

const search=document.getElementById("searchInput").value;

if(search)
query=query.ilike("name","%"+search+"%");

const filter=document.getElementById("priceFilter").value;

if(filter=="low")
query=query.order("price",{ascending:true});

if(filter=="high")
query=query.order("price",{ascending:false});

const {data}=await query;

const div=document.getElementById("home");

div.innerHTML="";

data.forEach(p=>{

div.innerHTML+=`

<div class="card"
onclick="openDetail('${p.id}')">

<img src="${p.image_url}">

<h3>${p.name}</h3>

<div class="price">₹${p.price}</div>

</div>

`;

});

}

loadProducts();

/* ================= PRODUCT DETAIL ================= */

async function openDetail(id){

hideAll();

detail.style.display="block";

const {data}=await supabase
.from("products")
.select("*")
.eq("id",id)
.single();

detail.innerHTML=`

<img src="${data.image_url}">

<h2>${data.name}</h2>

<div class="price">₹${data.price}</div>

<p>${data.description||""}</p>

<button class="btn"
onclick="addToCart('${data.id}')">
Add to Cart
</button>

`;

}

/* ================= CART ================= */

function addToCart(id){

let cart=JSON.parse(localStorage.getItem("cart"))||[];

cart.push(id);

localStorage.setItem("cart",JSON.stringify(cart));

alert("Added to cart");

}

async function showCart(){

hideAll();

cart.style.display="block";

const ids=JSON.parse(localStorage.getItem("cart"))||[];

cartList.innerHTML="";

for(let id of ids){

const {data}=await supabase
.from("products")
.select("*")
.eq("id",id)
.single();

cartList.innerHTML+=`

<div class="cart-item">

<img src="${data.image_url}"
width="60">

<div>
${data.name}
<br>
₹${data.price}
</div>

</div>

`;

}

}

/* ================= PROFILE ================= */

async function saveProfile(){

await supabase
.from("users")
.update({
name:nameInput.value,
phone:phoneInput.value
})
.eq("email",user.email);

alert("Saved");

}

/* ================= AVATAR ================= */

async function uploadAvatar(e){

const file=e.target.files[0];

await supabase.storage
.from("avatars")
.upload(user.email,file,{upsert:true});

const url=
"https://lssjsgfppehhclxqulso.supabase.co/storage/v1/object/public/avatars/"+user.email;

avatar.src=url;

}

/* ================= ADDRESS ================= */

async function saveAddress(){

await supabase.from("address")
.insert({
email:user.email,
address:addressInput.value
});

alert("Saved");

}

/* ================= NAV ================= */

function hideAll(){

home.style.display="none";
profile.style.display="none";
cart.style.display="none";
detail.style.display="none";
address.style.display="none";

}

function showHome(){

hideAll();

home.style.display="grid";

loadProducts();

}

function showProfile(){

hideAll();

profile.style.display="block";

}

function openAddress(){

hideAll();

address.style.display="block";

}

function logout(){

localStorage.removeItem("user");

location="index.html";

}

/* ================= SEARCH ================= */

searchInput.oninput=loadProducts;
priceFilter.onchange=loadProducts;

</script>

</body>
</html>
