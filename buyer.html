<!DOCTYPE html>
<html>
<head>

<meta name="viewport" content="width=device-width, initial-scale=1">

<title>PetalRush</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>

/* ---------- GLOBAL ---------- */

*{
box-sizing:border-box;
margin:0;
padding:0;
}

body{
font-family:system-ui;
background:#f2f3f7;
}

/* CONTAINER */

.container{

max-width:480px;
margin:auto;
background:white;
min-height:100vh;
position:relative;

}

@media(min-width:700px){

.container{
margin-top:20px;
margin-bottom:20px;
border-radius:12px;
box-shadow:0 0 25px rgba(0,0,0,0.15);
}

}

/* HEADER */

.header{

background:white;
padding:12px;
display:flex;
align-items:center;
gap:10px;
box-shadow:0 2px 10px rgba(0,0,0,0.1);

}

.logo{
height:40px;
}

.search{
flex:1;
}

.search input{

width:100%;
padding:10px;
border-radius:10px;
border:1px solid #ddd;

}

/* PRODUCTS */

.products{

display:grid;
grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
gap:10px;
padding:10px;
padding-bottom:80px;

}

.card{

background:white;
border-radius:12px;
padding:10px;
box-shadow:0 2px 10px rgba(0,0,0,0.1);

}

.card img{

width:100%;
aspect-ratio:1/1;
object-fit:cover;
border-radius:10px;

}

.price{

color:#ff4081;
font-weight:bold;

}

/* PROFILE */

.section{
display:none;
padding:15px;
padding-bottom:80px;
}

.profile-card{

background:white;
padding:15px;
border-radius:12px;
box-shadow:0 2px 10px rgba(0,0,0,0.1);
text-align:center;

}

.avatar{

width:90px;
height:90px;
border-radius:50%;
object-fit:cover;
margin-bottom:10px;

}

.input{

width:100%;
padding:10px;
border-radius:8px;
border:1px solid #ddd;
margin-top:10px;

}

.btn{

background:#ff4081;
color:white;
border:none;
padding:10px;
width:100%;
border-radius:8px;
margin-top:10px;
cursor:pointer;

}

.menu{

margin-top:10px;
background:white;
border-radius:12px;

}

.menu-item{

padding:15px;
border-bottom:1px solid #eee;
cursor:pointer;

}

/* ADDRESS */

.address-card{

background:white;
padding:12px;
border-radius:10px;
margin-top:10px;

}

/* NAV */

.bottom{

position:fixed;
bottom:0;
width:100%;
max-width:480px;
background:white;
display:flex;
justify-content:space-around;
padding:10px;
box-shadow:0 -2px 10px rgba(0,0,0,0.1);

}

.nav{
cursor:pointer;
}

</style>

</head>

<body>

<div class="container">

<div class="header">

<img src="logoHeader.png" class="logo">

<div class="search">
<input placeholder="Search flowers"
oninput="searchProducts(this.value)">
</div>

</div>


<!-- HOME -->

<div id="home" class="products"></div>


<!-- PROFILE -->

<div id="profile" class="section">

<div class="profile-card">

<img id="avatar"
class="avatar"
src="https://via.placeholder.com/100">

<input type="file"
onchange="uploadAvatar(event)">

<input id="nameInput"
class="input"
placeholder="Enter name">

<input id="phoneInput"
class="input"
placeholder="Enter phone">

<button class="btn"
onclick="saveProfile()">
Save Profile
</button>

</div>

<div class="menu">

<div class="menu-item"
onclick="showAddress()">
My Address
</div>

<div class="menu-item"
onclick="showOrders()">
My Orders
</div>

<div class="menu-item"
onclick="showHelp()">
Help & Support
</div>

<div class="menu-item"
onclick="logout()">
Logout
</div>

</div>

</div>


<!-- ADDRESS -->

<div id="address" class="section">

<h3>My Address</h3>

<div id="addressList"></div>

<input id="addressInput"
class="input"
placeholder="Enter address">

<button class="btn"
onclick="getGPS()">
Use GPS
</button>

<button class="btn"
onclick="saveAddress()">
Save Address
</button>

</div>


<!-- ORDERS -->

<div id="orders" class="section">

<h3>My Orders</h3>

<div id="orderList"></div>

</div>


<!-- HELP -->

<div id="help" class="section">

<h3>Help</h3>

<p id="adminEmail"></p>

<p id="adminPhone"></p>

</div>


<!-- NAV -->

<div class="bottom">

<div class="nav"
onclick="showHome()">Home</div>

<div class="nav"
onclick="showProfile()">Profile</div>

<div class="nav"
onclick="showOrders()">Orders</div>

</div>


</div>

<script>

const SUPABASE_URL="https://lssjsgfppehhclxqulso.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxzc2pzZ2ZwcGVoaGNseHF1bHNvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExOTAwNzksImV4cCI6MjA4Njc2NjA3OX0.nRq1iFBiOEyty0ALRmS45ARoso7BsB0ENOvttu7nvX0";

const client=supabase.createClient(
SUPABASE_URL,
SUPABASE_KEY
);

const user=JSON.parse(localStorage.getItem("user"));

if(!user){
location="index.html";
}

/* SHOW SECTIONS */

function hideAll(){

home.style.display="none";
profile.style.display="none";
address.style.display="none";
orders.style.display="none";
help.style.display="none";

}

function showHome(){

hideAll();
home.style.display="grid";

}

function showProfile(){

hideAll();
profile.style.display="block";
loadProfile();

}

function showAddress(){

hideAll();
address.style.display="block";
loadAddress();

}

function showOrders(){

hideAll();
orders.style.display="block";
loadOrders();

}

function showHelp(){

hideAll();
help.style.display="block";
loadAdmin();

}

/* PRODUCTS */

async function loadProducts(){

const {data}=await client
.from("products")
.select("*");

home.innerHTML="";

data.forEach(p=>{

home.innerHTML+=`

<div class="card">

<img src="${p.image_url}">

<div>${p.name}</div>

<div class="price">
₹${p.price}
</div>

</div>

`;

});

}

loadProducts();

function searchProducts(text){

const cards=document.querySelectorAll(".card");

cards.forEach(c=>{

c.style.display=
c.innerText.toLowerCase().includes(text.toLowerCase())
?"block":"none";

});

}

/* PROFILE */

async function loadProfile(){

const {data}=await client
.from("users")
.select("*")
.eq("email",user.email)
.single();

if(data){

nameInput.value=data.name||"";
phoneInput.value=data.phone||"";

if(data.avatar_url){
avatar.src=data.avatar_url;
}

}

}

async function saveProfile(){

const name=nameInput.value;
const phone=phoneInput.value;

await client
.from("users")
.update({name,phone})
.eq("email",user.email);

alert("Saved");

}

async function uploadAvatar(e){

const file=e.target.files[0];

await client.storage
.from("avatars")
.upload(user.email,file,{upsert:true});

const url=
SUPABASE_URL+
"/storage/v1/object/public/avatars/"+user.email;

avatar.src=url;

await client
.from("users")
.update({avatar_url:url})
.eq("email",user.email);

}

/* ADDRESS */

async function saveAddress(){

await client.from("addresses")
.insert({
user_email:user.email,
address:addressInput.value
});

loadAddress();

}

async function loadAddress(){

const {data}=await client
.from("addresses")
.select("*")
.eq("user_email",user.email);

addressList.innerHTML="";

data.forEach(a=>{

addressList.innerHTML+=`

<div class="address-card">

${a.address}

</div>

`;

});

}

function getGPS(){

navigator.geolocation.getCurrentPosition(pos=>{

addressInput.value=
"https://maps.google.com/?q="+
pos.coords.latitude+
","+pos.coords.longitude;

});

}

/* ORDERS */

async function loadOrders(){

const {data}=await client
.from("orders")
.select("*")
.eq("user_email",user.email);

orderList.innerHTML="";

data.forEach(o=>{

orderList.innerHTML+=`

<div class="address-card">

₹${o.total} — ${o.status}

</div>

`;

});

}

/* ADMIN */

async function loadAdmin(){

const {data}=await client
.from("admin")
.select("*")
.single();

adminEmail.innerText=data.email;
adminPhone.innerText=data.phone;

}

/* LOGOUT */

function logout(){

localStorage.removeItem("user");
location="index.html";

}

/* START */

showHome();

</script>

</body>
</html>
