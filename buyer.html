<!DOCTYPE html>
<html>
<head>

<meta name="viewport" content="width=device-width, initial-scale=1">

<title>PetalRush Buyer</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>

/* ================= GLOBAL ================= */

*{
box-sizing:border-box;
margin:0;
padding:0;
}

body{
font-family:system-ui,-apple-system,Segoe UI,Roboto;
background:#f4f6f8;
color:#222;
}

:root{
--primary:#ff4081;
--card:#ffffff;
--shadow:0 4px 14px rgba(0,0,0,0.08);
}


/* ================= CONTAINER ================= */

.container{
width:100%;
max-width:500px;
margin:auto;
min-height:100vh;
background:#f4f6f8;
position:relative;
padding-bottom:80px;
}

@media(min-width:700px){

.container{
margin-top:20px;
margin-bottom:20px;
border-radius:14px;
box-shadow:0 0 40px rgba(0,0,0,0.12);
}

}


/* ================= HEADER ================= */

.header{

position:sticky;
top:0;
z-index:100;

background:white;

padding:12px;

box-shadow:var(--shadow);

display:flex;
align-items:center;
gap:10px;

}

.logo{

height:34px;

}

.search{

flex:1;

}

.search input{

width:100%;
padding:10px;
border-radius:10px;
border:1px solid #ddd;

}


/* ================= PRODUCTS ================= */

.products{

display:grid;

grid-template-columns:repeat(auto-fit,minmax(140px,1fr));

gap:12px;

padding:12px;

}

.card{

background:white;
border-radius:12px;
padding:10px;
box-shadow:var(--shadow);

}

.card img{

width:100%;
aspect-ratio:1/1;
object-fit:cover;
border-radius:10px;

}

.card h3{

font-size:15px;
margin-top:5px;

}

.price{

color:var(--primary);
font-weight:bold;

}

.btn{

width:100%;
padding:9px;
margin-top:6px;
background:var(--primary);
color:white;
border:none;
border-radius:8px;
cursor:pointer;

}


/* ================= PROFILE ================= */

.profile{

display:none;
padding:12px;

}

.profile-card{

background:white;
padding:14px;
border-radius:12px;
box-shadow:var(--shadow);
text-align:center;

}

.avatar{

width:90px;
height:90px;
border-radius:50%;
object-fit:cover;

}

.menu{

background:white;
margin-top:12px;
border-radius:12px;
box-shadow:var(--shadow);

}

.menu-item{

padding:14px;
border-bottom:1px solid #eee;
cursor:pointer;

}


/* ================= ADDRESS ================= */

.address{

display:none;
padding:12px;

}

.input{

width:100%;
padding:10px;
border-radius:8px;
border:1px solid #ddd;
margin-bottom:10px;

}


/* ================= HELP ================= */

.help{

display:none;
padding:12px;

}

.help-card{

background:white;
padding:14px;
border-radius:12px;
box-shadow:var(--shadow);

}


/* ================= CART ================= */

.cart{

display:none;
padding:12px;

}

.cart-item{

background:white;
padding:10px;
margin-bottom:10px;
border-radius:10px;
box-shadow:var(--shadow);

}

.bill{

background:white;
padding:12px;
border-radius:12px;
box-shadow:var(--shadow);

}


/* ================= FOOTER ================= */

.bottom{

position:fixed;
bottom:0;
width:100%;
max-width:500px;

background:white;

display:flex;
justify-content:space-around;

padding:10px;

box-shadow:0 -3px 14px rgba(0,0,0,0.12);

}

.nav{

cursor:pointer;

}

</style>

</head>
<body>

<div class="container">


<!-- HEADER -->

<div class="header">

<img src="logoHeader.png" class="logo">

<div class="search">

<input placeholder="Search flowers"
oninput="searchProduct(this.value)">

</div>

</div>


<!-- PRODUCTS -->

<div id="home" class="products"></div>


<!-- PROFILE -->

<div id="profile" class="profile">

<div class="profile-card">

<img id="avatar"
class="avatar"
src="https://via.placeholder.com/90">

<br><br>

<input type="file"
onchange="uploadAvatar(event)">

<h3 id="username"></h3>

<input id="nameInput"
class="input"
placeholder="Edit name">

<input id="phoneInput"
class="input"
placeholder="Phone">

<button class="btn"
onclick="saveProfile()">

Save Profile

</button>

</div>


<div class="menu">

<div class="menu-item"
onclick="openAddress()">

My Address

</div>

<div class="menu-item"
onclick="openOrders()">

Orders

</div>

<div class="menu-item"
onclick="openHelp()">

Help & Support

</div>

<div class="menu-item"
onclick="logout()">

Logout

</div>

</div>

</div>


<!-- ADDRESS -->

<div id="address" class="address">

<h3>Address</h3>

<input id="addressInput"
class="input"
placeholder="Enter address">

<button class="btn"
onclick="useGPS()">

Use GPS

</button>

<button class="btn"
onclick="saveAddress()">

Save Address

</button>

</div>


<!-- HELP -->

<div id="help" class="help">

<div class="help-card">

<h3>Support</h3>

<p id="supportEmail"></p>

<p id="supportPhone"></p>

<textarea id="helpMsg"
class="input"
placeholder="Message"></textarea>

<button class="btn"
onclick="sendHelp()">

Send

</button>

</div>

</div>


<!-- CART -->

<div id="cart" class="cart"></div>


<!-- FOOTER -->

<div class="bottom">

<div class="nav"
onclick="showHome()">Home</div>

<div class="nav"
onclick="showProfile()">Profile</div>

<div class="nav"
onclick="showCart()">Cart</div>

</div>


</div>



<script>


// SUPABASE

const url="https://lssjsgfppehhclxqulso.supabase.co";

const key="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxzc2pzZ2ZwcGVoaGNseHF1bHNvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExOTAwNzksImV4cCI6MjA4Njc2NjA3OX0.nRq1iFBiOEyty0ALRmS45ARoso7BsB0ENOvttu7nvX0";

const client=supabase.createClient(url,key);


// USER

const user=JSON.parse(localStorage.getItem("user"));

document.getElementById("username").innerText=user.email;


// LOAD PRODUCTS

let allProducts=[];

async function loadProducts(){

const {data}=await client
.from("products")
.select("*");

allProducts=data;

showProducts(data);

}

function showProducts(data){

const div=document.getElementById("home");

div.innerHTML="";

data.forEach(p=>{

div.innerHTML+=`

<div class="card">

<img src="${p.image_url}">

<h3>${p.name}</h3>

<div class="price">₹${p.price}</div>

<button class="btn"
onclick="addCart('${p.id}')">

Add

</button>

</div>

`;

});

}

loadProducts();


// SEARCH

function searchProduct(q){

const filtered=allProducts.filter(p=>
p.name.toLowerCase().includes(q.toLowerCase())
);

showProducts(filtered);

}


// CART

let cart=[];

function addCart(id){

const p=allProducts.find(x=>x.id==id);

cart.push(p);

alert("Added");

}

function showCart(){

hideAll();

cartDiv=document.getElementById("cart");

cartDiv.style.display="block";

let total=0;

cartDiv.innerHTML="";

cart.forEach(p=>{

total+=p.price;

cartDiv.innerHTML+=`

<div class="cart-item">

${p.name} ₹${p.price}

</div>

`;

});

let gst=total*0.05;

let delivery=40;

let grand=total+gst+delivery;

cartDiv.innerHTML+=`

<div class="bill">

Total ₹${total}<br>

GST ₹${gst}<br>

Delivery ₹${delivery}<br>

<b>Grand ₹${grand}</b>

</div>

`;

}


// PROFILE

async function saveProfile(){

await client.from("users")
.update({

name:nameInput.value,
phone:phoneInput.value

})
.eq("email",user.email);

alert("Saved");

}


// AVATAR

async function uploadAvatar(e){

const file=e.target.files[0];

await client.storage
.from("avatars")
.upload(user.email,file,{upsert:true});

avatar.src=url+
"/storage/v1/object/public/avatars/"+user.email;

}


// ADDRESS

function useGPS(){

navigator.geolocation.getCurrentPosition(pos=>{

addressInput.value=
`https://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}`;

});

}

async function saveAddress(){

await client.from("users")
.update({address:addressInput.value})
.eq("email",user.email);

alert("Saved");

}


// HELP

async function openHelp(){

hideAll();

help.style.display="block";

const {data}=await client
.from("admin")
.select("*")
.single();

supportEmail.innerText=data.email;
supportPhone.innerText=data.phone;

}

async function sendHelp(){

await client.from("help")
.insert({

email:user.email,
message:helpMsg.value

});

alert("Sent");

}


// NAV

function hideAll(){

home.style.display="none";
profile.style.display="none";
cart.style.display="none";
address.style.display="none";
help.style.display="none";

}

function showHome(){

hideAll();
home.style.display="grid";

}

function showProfile(){

hideAll();
profile.style.display="block";

}


// LOGOUT

function logout(){

localStorage.removeItem("user");

location="index.html";

}

</script>

</body>
</html>
